<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>10Express | Hun</title><meta name="author" content="ehco"><meta name="copyright" content="ehco"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Express路由和中间件1234567891011121314151617181920212223242526272829303132333435const express &#x3D; require(&quot;express&quot;);&#x2F;&#x2F;获取服务器的实例(对象)const app &#x3D; express();&#x2F;&#x2F;路由&#x2F;&#x2F;在路由的执行中需要做两件事&#x2F;&#x2F;1.读取用户的请求(request)&#x2F;&#x2F; 2.根">
<meta property="og:type" content="article">
<meta property="og:title" content="10Express">
<meta property="og:url" content="https://hun.ghao.live/posts/102acd90.html">
<meta property="og:site_name" content="Hun">
<meta property="og:description" content="Express路由和中间件1234567891011121314151617181920212223242526272829303132333435const express &#x3D; require(&quot;express&quot;);&#x2F;&#x2F;获取服务器的实例(对象)const app &#x3D; express();&#x2F;&#x2F;路由&#x2F;&#x2F;在路由的执行中需要做两件事&#x2F;&#x2F;1.读取用户的请求(request)&#x2F;&#x2F; 2.根">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://img0.baidu.com/it/u=302718224,1591236974&fm=253&fmt=auto&app=138&f=JPEG?w=600&h=450">
<meta property="article:published_time" content="2022-11-17T00:00:00.000Z">
<meta property="article:modified_time" content="2022-12-19T12:57:12.643Z">
<meta property="article:author" content="ehco">
<meta property="article:tag" content="前端&#x2F;Node">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://img0.baidu.com/it/u=302718224,1591236974&fm=253&fmt=auto&app=138&f=JPEG?w=600&h=450"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://hun.ghao.live/posts/102acd90"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="baidu-site-verification" content="code-2h0nFZnNKu"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"该文章创建于","messageNext":"天前, 请以最新文章为主"},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":300},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: ehco","link":"链接: ","source":"来源: Hun","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '10Express',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-12-19 12:57:12'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/style.css"><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/./images/touxiang.jpeg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">45</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">6</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fa fa-heartbeat"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></li><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://img0.baidu.com/it/u=302718224,1591236974&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=JPEG?w=600&amp;h=450')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Hun</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fa fa-heartbeat"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></li><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">10Express</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-11-17T00:00:00.000Z" title="发表于 2022-11-17 00:00:00">2022-11-17</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-12-19T12:57:12.643Z" title="更新于 2022-12-19 12:57:12">2022-12-19</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%89%8D%E7%AB%AF-Node/">前端/Node</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">6.5k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>30分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="10Express"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="Express"><a href="#Express" class="headerlink" title="Express"></a>Express</h1><h2 id="路由和中间件"><a href="#路由和中间件" class="headerlink" title="路由和中间件"></a>路由和中间件</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br><span class="line"><span class="comment">//获取服务器的实例(对象)</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"><span class="comment">//路由</span></span><br><span class="line"><span class="comment">//在路由的执行中需要做两件事</span></span><br><span class="line"><span class="comment">//1.读取用户的请求(request)</span></span><br><span class="line"><span class="comment">// 2.根据用户的请求返回响应(response)</span></span><br><span class="line"><span class="comment">// 路由的回调执行时,会接收两个参数</span></span><br><span class="line"><span class="comment">// 1. request 2.response</span></span><br><span class="line"><span class="comment">// app.get(&quot;/&quot;, (req, res) =&gt; &#123;</span></span><br><span class="line"><span class="comment">//   //req 表示用户的请求信息,通过req可以获取用户传递的数据</span></span><br><span class="line"><span class="comment">//   console.log(&#x27;正在访问根目录&#x27;);</span></span><br><span class="line"><span class="comment">//   console.log(req);</span></span><br><span class="line"><span class="comment">//   console.log(req.url);</span></span><br><span class="line"><span class="comment">//   // res表示服务器发送给服务器的响应信息,通过res向客户端返回数据</span></span><br><span class="line"><span class="comment">//   console.log(res);</span></span><br><span class="line"><span class="comment">//   // res.sendStatus(404);</span></span><br><span class="line"><span class="comment">//   res.status(200);</span></span><br><span class="line"><span class="comment">//   res.send(&#x27;你的请求没问题,但是不能给你看&#x27;)</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"><span class="comment">//中间件</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&quot;/hello&quot;</span>, <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;收到请求111&quot;</span>);</span><br><span class="line">  <span class="comment">// res.send(&#x27;这是通过中间件返回的响应111&#x27;) //未放行,后续中间件不会执行</span></span><br><span class="line">  <span class="title function_">next</span>(); <span class="comment">//放行,后续中间件执行</span></span><br><span class="line">&#125;);</span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&quot;/hello&quot;</span>, <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;收到请求222&quot;</span>);</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">&quot;这是通过中间件返回的响应222&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//启动服务器</span></span><br><span class="line"><span class="comment">//app.listen(端口号) 监听端口号</span></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;服务器已经启动&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>express 是 node 中的服务器软件，通过 express 可以快速的在 node 中搭建一个 web 服务器</p>
<ol>
<li><p>通过创建<strong>实例对象</strong>来<strong>创建服务器实例</strong></p>
</li>
<li><p>通过<code>listen(端口号)</code>来启动服务器</p>
</li>
<li><p>路由</p>
<ul>
<li><p>如果希望服务器能够正常访问,则需要为服务器设置路由,路由可以根据不同的请求方式和请求地址来处理用户的请求</p>
</li>
<li><p><code>app.METHOD(...)</code>:方法可以是<code>get</code>或者<code>post</code>…来创建路由</p>
</li>
</ul>
</li>
<li><p>中间件</p>
<ul>
<li>在 express 中我们使用<code>.use</code>来定义一个中间件,中间件作用和路由很像,用法也很像但是不区分请求方式,只看路径</li>
<li>会匹配所有请求(模糊匹配,匹配开头路径及以下的子路径),路径设置父目录</li>
</ul>
</li>
<li><p>(路由&#x2F;中间件)回调函数的参数</p>
<ul>
<li><strong>requset</strong>:<ul>
<li><code>.url</code>:返回请求的 url 地址</li>
<li><code>.query(get请求)</code>:表示查询字符串中的参数</li>
</ul>
</li>
</ul>
</li>
</ol>
<ul>
<li><p><strong>response</strong>:</p>
<ul>
<li><p><code>.sendStatus()</code>:向客户端发送响应状态码</p>
</li>
<li><p><code>.status()</code>:设置响应状态码,但是不发送</p>
</li>
<li><p><code>.send()</code>:设置状态码并发送响应体</p>
</li>
<li><p><strong>next</strong>:</p>
<ol>
<li><code>next()</code>是一个函数,调用函数后会触发后续的中间件</li>
</ol>
</li>
</ul>
<ol start="2">
<li><code>next()</code>不能在响应处理完毕后调用</li>
</ol>
</li>
</ul>
</blockquote>
<blockquote>
<p>第一次使用 yarn 安装 nodemon 时,需要配置 yarn 的环境变量</p>
</blockquote>
<h2 id="静态资源"><a href="#静态资源" class="headerlink" title="静态资源"></a>静态资源</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br><span class="line"><span class="comment">//获取服务器的实例(对象)</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">static</span>(<span class="string">&quot;public&quot;</span>)); <span class="comment">//将public设置为静态资源目录</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">&quot;根目录&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/login&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;请求已经收到&quot;</span>);</span><br><span class="line">  <span class="comment">//获取用户输入的用户名和密码</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">query</span>.<span class="property">username</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">query</span>.<span class="property">password</span>);</span><br><span class="line">  <span class="comment">//判断密码是否正确</span></span><br><span class="line">  <span class="keyword">if</span> (req.<span class="property">query</span>.<span class="property">username</span> === <span class="string">&quot;zhang&quot;</span> &amp;&amp; req.<span class="property">query</span>.<span class="property">password</span> === <span class="string">&quot;123456&quot;</span>) &#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&quot;&lt;h1&gt;登陆成功&lt;/h1&gt;&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&quot;&lt;h1&gt;用户名或密码错误&lt;/h1&gt;&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">&quot;登陆成功&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//启动服务器</span></span><br><span class="line"><span class="comment">//app.listen(端口号) 监听端口号</span></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;服务器已经启动&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>服务器中的代码对外部来说都是不可见的,一般情况下我们编写的 html 页面浏览器都无法直接访问,如果希望浏览器能够访问,则需要将页面所在的目录设置为<strong>静态资源</strong>目录</p>
<ul>
<li><code>express.static</code>:设置 static 中间件后,浏览器访问时,会自动去 public 目录下寻找是否有匹配的静态资源</li>
</ul>
</blockquote>
<h2 id="param-和-post"><a href="#param-和-post" class="headerlink" title="param 和 post"></a>param 和 post</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="comment">//获取服务器的实例(对象)</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"><span class="comment">// 引入解析请求体的中间件</span></span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">urlencoded</span>());</span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">static</span>(path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;public&quot;</span>))); <span class="comment">//将public设置为静态资源目录</span></span><br><span class="line"><span class="comment">//添加路由</span></span><br><span class="line"><span class="comment">//get请求发送参数的第二种方式</span></span><br><span class="line"><span class="comment">// /hello/:id 表示用户访问 /hello/xxx 时会触发,</span></span><br><span class="line"><span class="comment">// 在路径中以冒号命名的部分我们称为param,在git请求中它可以被解析为请求参数,一般情况下不会设置太多的参数</span></span><br><span class="line"><span class="comment">// app.get(&quot;/hello/:id&quot;, (req, res) =&gt; &#123;</span></span><br><span class="line"><span class="comment">//   //可以通过req.params属性来获取这些参数</span></span><br><span class="line"><span class="comment">//   console.log(req.params);</span></span><br><span class="line"><span class="comment">//   res.send(&#x27;hello页面&#x27;);</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"><span class="comment">//post请求发送参数</span></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&quot;/login&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">body</span>);</span><br><span class="line">  <span class="comment">// res.send(&#x27;&lt;h1&gt;post请求发送参数&lt;/h1&gt;&#x27;);</span></span><br><span class="line">  <span class="keyword">const</span> username = req.<span class="property">body</span>.<span class="property">username</span>;</span><br><span class="line">  <span class="keyword">const</span> password = req.<span class="property">body</span>.<span class="property">password</span>;</span><br><span class="line">  <span class="keyword">if</span> (username === <span class="string">&quot;admin&quot;</span> &amp;&amp; password === <span class="string">&quot;123456&quot;</span>) &#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&quot;登录成功&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&quot;登录失败&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//启动服务器</span></span><br><span class="line"><span class="comment">//app.listen(端口号) 监听端口号</span></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;服务器已经启动&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>param</strong>:(约定优于配置)</p>
<ul>
<li>在路径中以冒号命名的部分我们称为 param,在 git 请求中它可以被解析为请求参数,一般情况下不会设置太多的参数</li>
</ul>
<p><strong>post</strong>:</p>
<ul>
<li><code>.body</code>:获取 post 请求的参数(请求体中的参数)</li>
<li>默认情况下 express 不会自动解析请求体,需要通过中间件来添加功能</li>
</ul>
</blockquote>
<p><strong>登录注册小练习</strong>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="comment">//获取服务器的实例(对象)</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"><span class="comment">// 引入解析请求体的中间件</span></span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">urlencoded</span>());</span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">static</span>(path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;public&quot;</span>))); <span class="comment">//将public设置为静态资源目录</span></span><br><span class="line"><span class="comment">//创建一个数组来模拟数据库</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">USERS</span> = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">username</span>: <span class="string">&quot;admin&quot;</span>,</span><br><span class="line">    <span class="attr">password</span>: <span class="string">&quot;100000&quot;</span>,</span><br><span class="line">    <span class="attr">nickname</span>: <span class="string">&quot;超级管理员&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">username</span>: <span class="string">&quot;zs&quot;</span>,</span><br><span class="line">    <span class="attr">password</span>: <span class="string">&quot;120000&quot;</span>,</span><br><span class="line">    <span class="attr">nickname</span>: <span class="string">&quot;张三&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">];</span><br><span class="line"><span class="comment">//添加路由</span></span><br><span class="line"><span class="comment">//post请求发送参数</span></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&quot;/login&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">body</span>);</span><br><span class="line">  <span class="comment">// res.send(&#x27;&lt;h1&gt;post请求发送参数&lt;/h1&gt;&#x27;);</span></span><br><span class="line">  <span class="keyword">const</span> username = req.<span class="property">body</span>.<span class="property">username</span>;</span><br><span class="line">  <span class="keyword">const</span> password = req.<span class="property">body</span>.<span class="property">password</span>;</span><br><span class="line">  <span class="comment">//遍历数组</span></span><br><span class="line">  <span class="comment">// for (const user of USERS) &#123;</span></span><br><span class="line">  <span class="comment">//   if (user.username === username &amp;&amp; user.password === password) &#123;</span></span><br><span class="line">  <span class="comment">//     res.send(`登录成功$&#123;user.nickname&#125;`);</span></span><br><span class="line">  <span class="comment">//     return;</span></span><br><span class="line">  <span class="comment">//   &#125;</span></span><br><span class="line">  <span class="comment">// &#125;</span></span><br><span class="line">  <span class="comment">// res.send(&quot;登录失败&quot;);</span></span><br><span class="line">  <span class="keyword">const</span> loginUser = <span class="variable constant_">USERS</span>.<span class="title function_">find</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> item.<span class="property">username</span> === username &amp;&amp; item.<span class="property">password</span> === password;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">if</span> (loginUser) &#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">`登录成功<span class="subst">$&#123;loginUser.nickname&#125;</span>`</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&quot;登录失败&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//注册post请求</span></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&quot;/register&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//获取用户输入的数据</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">body</span>);</span><br><span class="line">  <span class="comment">//解构赋值,把req.body获取到的数据解构出来</span></span><br><span class="line">  <span class="keyword">const</span> &#123; username, password, repwd, nickname &#125; = req.<span class="property">body</span>;</span><br><span class="line">  <span class="comment">//验证用户名是否存在</span></span><br><span class="line">  <span class="keyword">const</span> user = <span class="variable constant_">USERS</span>.<span class="title function_">find</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> item.<span class="property">username</span> === username || item.<span class="property">password</span> === password;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">if</span> (!user) &#123;</span><br><span class="line">    <span class="variable constant_">USERS</span>.<span class="title function_">push</span>(&#123;</span><br><span class="line">      username,</span><br><span class="line">      password,</span><br><span class="line">      nickname,</span><br><span class="line">    &#125;);</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&quot;注册成功&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&quot;用户已存在&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//启动服务器</span></span><br><span class="line"><span class="comment">//app.listen(端口号) 监听端口号</span></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;服务器已经启动&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="模板引擎"><a href="#模板引擎" class="headerlink" title="模板引擎"></a>模板引擎</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">static</span>(path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;public&quot;</span>)));</span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">urlencoded</span>());</span><br><span class="line"><span class="comment">//将ejs设置为默认的模板引擎</span></span><br><span class="line">app.<span class="title function_">set</span>(<span class="string">&quot;view engine&quot;</span>, <span class="string">&quot;ejs&quot;</span>);</span><br><span class="line"><span class="comment">//配置模板引擎的路径</span></span><br><span class="line">app.<span class="title function_">set</span>(<span class="string">&quot;views&quot;</span>, path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;views&quot;</span>));</span><br><span class="line"><span class="keyword">let</span> name = <span class="string">&quot;瑞克&quot;</span>;</span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/students&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">render</span>(<span class="string">&quot;students&quot;</span>, &#123; name &#125;, &#123; <span class="attr">hello</span>: <span class="string">&quot;&lt;h1&gt;张三&lt;/h1&gt;&quot;</span> &#125;);</span><br><span class="line">&#125;);</span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/set_name&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  name = req.<span class="property">query</span>.<span class="property">name</span>;</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">&quot;修改成功&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//配置错误路由</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//该中间件执行时,说明上面所有的路由都没有匹配</span></span><br><span class="line">  res.<span class="title function_">status</span>(<span class="number">404</span>);</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">&quot;&lt;h1&gt;你访问的网页被外星人劫持了!!!&lt;/h1&gt;&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;服务器已启动~&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">  &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt;</span><br><span class="line">  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="line">  &lt;title&gt;ejs模板引擎&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;h1&gt;hello ejs&lt;/h1&gt;</span><br><span class="line">  &lt;!--通过它可以将render传递进来的数据,直接在网页中显示出来 --&gt;</span><br><span class="line">  &lt;%#=hello%&gt;</span><br><span class="line">  &lt;!-- 存在xss注入风险 --&gt;</span><br><span class="line">  &lt;%#-hello%&gt;</span><br><span class="line">  &lt;%-name %&gt;</span><br><span class="line">  &lt;form action=&quot;/set_name&quot;&gt;</span><br><span class="line">    &lt;input type=&quot;text&quot; name=&quot;name&quot; placeholder=&quot;请输入名字&quot;&gt;&lt;/input&gt;</span><br><span class="line">    &lt;button&gt;提交&lt;/button&gt;</span><br><span class="line">  &lt;/form&gt;</span><br><span class="line">  &lt;% if(name === &#x27;张三&#x27;) &#123; %&gt;</span><br><span class="line">    &lt;h2&gt;1111&lt;/h2&gt;</span><br><span class="line">  &lt;% &#125;else&#123; %&gt;</span><br><span class="line">    &lt;h2&gt;2222&lt;/h2&gt;</span><br><span class="line">  &lt;% &#125; %&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>ejs 模板引擎</strong>:</p>
<ul>
<li>ejs 是 node 中的一款模板引擎<ol>
<li>安装 ejs</li>
<li>配置 express 的模板引擎为 ejs</li>
</ol>
</li>
<li>注意:模板引擎需要被 express 渲染后才能使用</li>
<li>通过<code>res.render()</code>来渲染引擎模板,并将其返回给浏览器<ol>
<li>第一个参数传递 ejs 名称</li>
<li>可以将一个对象作为第二个参数传递,这样在模板中就可以访问到对象中的数据</li>
<li>在 ejs 模板中可以通过:<ul>
<li><code>&lt;%=对象名%&gt;</code>:传递的数据带有标签则会被转义</li>
<li><code>&lt;%-对象名%&gt;</code>:传递的数据带有标签,不会被转义,存在被 xss 注入的风险</li>
<li><code>&lt;% %&gt;</code>:可以在其中直接编写 js 代码,js 代码会在服务器中执行</li>
</ul>
</li>
<li>注意: 在 ejs 模板中因为是服务器进行的渲染,要使用<code>&lt;%# %&gt;</code>来注释代码</li>
</ol>
</li>
<li><code>res.redirect()</code>:重定向,告诉浏览器向另外一个地址再发送一个请求</li>
</ul>
</blockquote>
<p><strong>学生列表的增删改查练习</strong>:</p>
<p><code>index.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs/promises&quot;</span>);</span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">static</span>(path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;public&quot;</span>)));</span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">urlencoded</span>());</span><br><span class="line"><span class="comment">//将ejs设置为默认的模板引擎</span></span><br><span class="line">app.<span class="title function_">set</span>(<span class="string">&quot;view engine&quot;</span>, <span class="string">&quot;ejs&quot;</span>);</span><br><span class="line"><span class="comment">//配置模板引擎的路径</span></span><br><span class="line">app.<span class="title function_">set</span>(<span class="string">&quot;views&quot;</span>, path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;views&quot;</span>));</span><br><span class="line"><span class="keyword">let</span> <span class="variable constant_">STUDENT</span> = <span class="built_in">require</span>(<span class="string">&quot;./data/students.json&quot;</span>);</span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/students&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">render</span>(<span class="string">&quot;students&quot;</span>, &#123; <span class="attr">stus</span>: <span class="variable constant_">STUDENT</span> &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//创建添加学生信息的路由</span></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&quot;/add_student&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//在路由中要做什么</span></span><br><span class="line">  <span class="comment">//生成一个id</span></span><br><span class="line">  <span class="keyword">const</span> id = <span class="variable constant_">STUDENT</span>.<span class="title function_">at</span>(-<span class="number">1</span>) ? <span class="variable constant_">STUDENT</span>.<span class="title function_">at</span>(-<span class="number">1</span>).<span class="property">id</span> + <span class="number">1</span> : <span class="number">1</span>;</span><br><span class="line">  <span class="comment">//1.获取用户填写的信息</span></span><br><span class="line">  <span class="keyword">const</span> &#123; name, age, gender &#125; = req.<span class="property">body</span>;</span><br><span class="line">  <span class="keyword">const</span> newUser = &#123;</span><br><span class="line">    id,</span><br><span class="line">    <span class="attr">name</span>: name,</span><br><span class="line">    <span class="attr">age</span>: +age,</span><br><span class="line">    <span class="attr">gender</span>: gender,</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">body</span>);</span><br><span class="line">  <span class="comment">//2.验证用信息(略)</span></span><br><span class="line">  <span class="comment">//3.将用户信息添加到数据中</span></span><br><span class="line">  <span class="variable constant_">STUDENT</span>.<span class="title function_">push</span>(newUser);</span><br><span class="line">  fs.<span class="title function_">writeFile</span>(</span><br><span class="line">    path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;./data/students.json&quot;</span>),</span><br><span class="line">    <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="variable constant_">STUDENT</span>)</span><br><span class="line">  )</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">//重定向</span></span><br><span class="line">      res.<span class="title function_">redirect</span>(<span class="string">&quot;/students&quot;</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">catch</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(失败);</span><br><span class="line">    &#125;);</span><br><span class="line">  <span class="comment">//4.返回响应</span></span><br><span class="line">  <span class="comment">//这种方式体验不好,添加成功还需要回退,刷新才能显示</span></span><br><span class="line">  <span class="comment">// res.send(&#x27;添加成功&#x27;);</span></span><br><span class="line">  <span class="comment">//直接在路由中渲染ejs虽然能够实现效果,但是会存在表单重复提交的问题</span></span><br><span class="line">  <span class="comment">// res.render(&quot;students&quot;, &#123;stus: STUDENT&#125;);</span></span><br><span class="line">  <span class="comment">//使用res.redirect进行重定向, 告诉浏览器向另外一个地址在发送一个请求</span></span><br><span class="line">  <span class="comment">// res.redirect(&quot;/students&quot;);</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建删除学生信息的路由</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/delete&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//1.获取要删除的学生id</span></span><br><span class="line">  <span class="keyword">const</span> id = +req.<span class="property">query</span>.<span class="property">id</span>;</span><br><span class="line">  <span class="comment">//2.根据id删除学生</span></span><br><span class="line">  <span class="variable constant_">STUDENT</span> = <span class="variable constant_">STUDENT</span>.<span class="title function_">filter</span>(<span class="function">(<span class="params">stu</span>) =&gt;</span> stu.<span class="property">id</span> !== id);</span><br><span class="line">  fs.<span class="title function_">writeFile</span>(</span><br><span class="line">    path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;./data/students.json&quot;</span>),</span><br><span class="line">    <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="variable constant_">STUDENT</span>)</span><br><span class="line">  )</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">//重定向</span></span><br><span class="line">      res.<span class="title function_">redirect</span>(<span class="string">&quot;/students&quot;</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">catch</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(失败);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//创建修改学生信息的路由</span></span><br><span class="line"><span class="comment">//数据回显</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/to-update&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//获取学生id</span></span><br><span class="line">  <span class="keyword">const</span> id = +req.<span class="property">query</span>.<span class="property">id</span>;</span><br><span class="line">  <span class="keyword">const</span> student = <span class="variable constant_">STUDENT</span>.<span class="title function_">find</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> item.<span class="property">id</span> === id);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(student);</span><br><span class="line">  res.<span class="title function_">render</span>(<span class="string">&quot;update&quot;</span>, &#123; student &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//数据提交</span></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&quot;/update-student&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//获取id(通过查询字符串,注意要用query获取)</span></span><br><span class="line">  <span class="comment">// const id = req.query.id;</span></span><br><span class="line">  <span class="keyword">const</span> &#123; id, name, age, gender &#125; = req.<span class="property">body</span>;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(id, name, age, gender);</span><br><span class="line">  <span class="comment">//根据id修改学生信息</span></span><br><span class="line">  <span class="keyword">const</span> student = <span class="variable constant_">STUDENT</span>.<span class="title function_">find</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> item.<span class="property">id</span> == id);</span><br><span class="line">  student.<span class="property">name</span> = name;</span><br><span class="line">  student.<span class="property">age</span> = +age;</span><br><span class="line">  student.<span class="property">gender</span> = gender;</span><br><span class="line">  <span class="comment">//写入文件, 重定向</span></span><br><span class="line">  fs.<span class="title function_">writeFile</span>(</span><br><span class="line">    path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;./data/students.json&quot;</span>),</span><br><span class="line">    <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="variable constant_">STUDENT</span>)</span><br><span class="line">  )</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">//重定向</span></span><br><span class="line">      res.<span class="title function_">redirect</span>(<span class="string">&quot;/students&quot;</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">catch</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(失败);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 配置错误路由</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//该中间件执行时,说明上面所有的路由都没有匹配</span></span><br><span class="line">  res.<span class="title function_">status</span>(<span class="number">404</span>);</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">&quot;&lt;h1&gt;你访问的网页被外星人劫持了!!!&lt;/h1&gt;&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;服务器已启动~&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><code>students.ejs</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">  &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt;</span><br><span class="line">  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="line">  &lt;title&gt;ejs模板引擎&lt;/title&gt;</span><br><span class="line">  &lt;style&gt;</span><br><span class="line">    table &#123;</span><br><span class="line">      border-collapse: collapse;</span><br><span class="line">    &#125;</span><br><span class="line">    th, td &#123;</span><br><span class="line">      border: 1px #000 solid;</span><br><span class="line">      font-size: 20px;</span><br><span class="line">      padding: 10px;</span><br><span class="line">      text-align: center;</span><br><span class="line">    &#125;</span><br><span class="line">    caption &#123;</span><br><span class="line">      font-size: 25px;</span><br><span class="line">    &#125;</span><br><span class="line">  &lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;h1&gt;hello ejs&lt;/h1&gt;</span><br><span class="line">  &lt;%for(const stu of stus) &#123; %&gt;</span><br><span class="line">    &lt;%= stu.id%&gt; - &lt;%= stu.name %&gt; - &lt;%= stu.age %&gt; - &lt;%= stu.gender %&gt;</span><br><span class="line">    &lt;br&gt;</span><br><span class="line">  &lt;% &#125; %&gt;</span><br><span class="line">  &lt;% if(stus &amp;&amp; stus.length&gt;0) &#123; %&gt;</span><br><span class="line">  &lt;table&gt;</span><br><span class="line">    &lt;caption&gt;学生信息&lt;/caption&gt;</span><br><span class="line">    &lt;thead&gt;</span><br><span class="line">      &lt;tr&gt;</span><br><span class="line">        &lt;th&gt;学号&lt;/th&gt;</span><br><span class="line">        &lt;th&gt;姓名&lt;/th&gt;</span><br><span class="line">        &lt;th&gt;年龄&lt;/th&gt;</span><br><span class="line">        &lt;th&gt;性别&lt;/th&gt;</span><br><span class="line">        &lt;th&gt;操作&lt;/th&gt;</span><br><span class="line">      &lt;/tr&gt;</span><br><span class="line">    &lt;/thead&gt;</span><br><span class="line">    &lt;tbody&gt;</span><br><span class="line">      &lt;% for(const stu of stus) &#123; %&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">          &lt;td&gt;&lt;%= stu.id%&gt;&lt;/td&gt;</span><br><span class="line">          &lt;td&gt;&lt;%= stu.name%&gt;&lt;/td&gt;</span><br><span class="line">          &lt;td&gt;&lt;%= stu.age%&gt;&lt;/td&gt;</span><br><span class="line">          &lt;td&gt;&lt;%= stu.gender%&gt;&lt;/td&gt;</span><br><span class="line">          &lt;td&gt;</span><br><span class="line">            &lt;a onclick=&quot;return confirm(&#x27;确认删除吗?&#x27;)&quot; href=&quot;/delete?id=&lt;%=stu.id%&gt; &quot;&gt;删除&lt;/a&gt;</span><br><span class="line">            &lt;a href=&quot;/to-update?id=&lt;%=stu.id%&gt; &quot;&gt;修改&lt;/a&gt;</span><br><span class="line">          &lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">      &lt;% &#125; %&gt;</span><br><span class="line">    &lt;/tbody&gt;</span><br><span class="line">  &lt;/table&gt;</span><br><span class="line">  &lt;% &#125;else&#123; %&gt;</span><br><span class="line">    &lt;p&gt;学生列表为空!!&lt;/p&gt;</span><br><span class="line">    &lt;% &#125; %&gt;</span><br><span class="line">  &lt;hr&gt;</span><br><span class="line">  &lt;form action=&quot;/add_student&quot; method=&quot;post&quot;&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      姓名: &lt;input type=&quot;text&quot; name=&quot;name&quot;&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      年龄: &lt;input type=&quot;number&quot; max=&quot;150&quot; min=&quot;0&quot; name=&quot;age&quot;&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      性别: &lt;input type=&quot;radio&quot; name=&quot;gender&quot; value=&quot;男&quot;&gt;男&lt;/input&gt;</span><br><span class="line">      &lt;input type=&quot;radio&quot; name=&quot;gender&quot; value=&quot;女&quot;&gt;女&lt;/input&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;button&gt;添加&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p><code>update.ejs</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">  &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt;</span><br><span class="line">  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="line">  &lt;title&gt;Document&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;h1&gt;修改学生列表信息&lt;/h1&gt;</span><br><span class="line">  &lt;form action=&quot;/update-student&quot; method=&quot;post&quot;&gt;</span><br><span class="line">    &lt;!-- 通过hidden隐藏表单项,这样可以传递一些不希望被用户看到的数据 --&gt;</span><br><span class="line">    &lt;input type=&quot;hidden&quot; name=&quot;id&quot; value=&quot;&lt;%=student.id %&gt; &quot;&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      姓名: &lt;input type=&quot;text&quot; name=&quot;name&quot; value=&quot;&lt;%=student.name %&gt; &quot;&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      年龄: &lt;input type=&quot;number&quot; max=&quot;150&quot; min=&quot;0&quot; name=&quot;age&quot; value=&quot;&lt;%=student.age %&gt;&quot;&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      性别: &lt;input type=&quot;radio&quot; name=&quot;gender&quot; value=&quot;男&quot; &lt;%= student.gender === &#x27;男&#x27; &amp;&amp; &quot;checked&quot; %&gt; &gt;男&lt;/input&gt;</span><br><span class="line">      &lt;input type=&quot;radio&quot; name=&quot;gender&quot; value=&quot;女&quot; &lt;%= student.gender === &#x27;女&#x27; &amp;&amp; &quot;checked&quot; %&gt; &gt;女&lt;/input&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;button&gt;修改&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h2 id="Router"><a href="#Router" class="headerlink" title="Router"></a>Router</h2><p><strong>使用 router 对 index.js 进行解耦</strong>:</p>
<p><code>student.js</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> router = express.<span class="title class_">Router</span>();</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs/promises&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> <span class="variable constant_">STUDENT</span> = <span class="built_in">require</span>(<span class="string">&quot;../data/students.json&quot;</span>);</span><br><span class="line"><span class="comment">//学生列表路由</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/list&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">render</span>(<span class="string">&quot;students&quot;</span>, &#123; <span class="attr">stus</span>: <span class="variable constant_">STUDENT</span> &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//添加学生路由</span></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&quot;/add&quot;</span>, <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//生成一个id</span></span><br><span class="line">  <span class="keyword">const</span> id = <span class="variable constant_">STUDENT</span>.<span class="title function_">at</span>(-<span class="number">1</span>) ? <span class="variable constant_">STUDENT</span>.<span class="title function_">at</span>(-<span class="number">1</span>).<span class="property">id</span> + <span class="number">1</span> : <span class="number">1</span>;</span><br><span class="line">  <span class="comment">//1.获取用户填写的信息</span></span><br><span class="line">  <span class="keyword">const</span> &#123; name, age, gender &#125; = req.<span class="property">body</span>;</span><br><span class="line">  <span class="keyword">const</span> newUser = &#123;</span><br><span class="line">    id,</span><br><span class="line">    <span class="attr">name</span>: name,</span><br><span class="line">    <span class="attr">age</span>: +age,</span><br><span class="line">    <span class="attr">gender</span>: gender,</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">body</span>);</span><br><span class="line">  <span class="comment">//2.验证用信息(略)</span></span><br><span class="line">  <span class="comment">//3.将用户信息添加到数据中</span></span><br><span class="line">  <span class="variable constant_">STUDENT</span>.<span class="title function_">push</span>(newUser);</span><br><span class="line">  <span class="comment">//调用next让后续路由继续处理,进入存储文件中间件</span></span><br><span class="line">  <span class="title function_">next</span>();</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//删除学生路由</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/delete&quot;</span>, <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//1.获取要删除的学生id</span></span><br><span class="line">  <span class="keyword">const</span> id = +req.<span class="property">query</span>.<span class="property">id</span>;</span><br><span class="line">  <span class="comment">//2.根据id删除学生</span></span><br><span class="line">  <span class="variable constant_">STUDENT</span> = <span class="variable constant_">STUDENT</span>.<span class="title function_">filter</span>(<span class="function">(<span class="params">stu</span>) =&gt;</span> stu.<span class="property">id</span> !== id);</span><br><span class="line">  <span class="title function_">next</span>();</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//修改学生路由</span></span><br><span class="line"><span class="comment">//数据回显</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/to-update&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//获取学生id</span></span><br><span class="line">  <span class="keyword">const</span> id = +req.<span class="property">query</span>.<span class="property">id</span>;</span><br><span class="line">  <span class="keyword">const</span> student = <span class="variable constant_">STUDENT</span>.<span class="title function_">find</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> item.<span class="property">id</span> === id);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(student);</span><br><span class="line">  res.<span class="title function_">render</span>(<span class="string">&quot;update&quot;</span>, &#123; student &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//数据提交</span></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&quot;/update-student&quot;</span>, <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//获取id(通过查询字符串,注意要用query获取)</span></span><br><span class="line">  <span class="comment">// const id = req.query.id;</span></span><br><span class="line">  <span class="keyword">const</span> &#123; id, name, age, gender &#125; = req.<span class="property">body</span>;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(id, name, age, gender);</span><br><span class="line">  <span class="comment">//根据id修改学生信息</span></span><br><span class="line">  <span class="keyword">const</span> student = <span class="variable constant_">STUDENT</span>.<span class="title function_">find</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> item.<span class="property">id</span> == id);</span><br><span class="line">  student.<span class="property">name</span> = name;</span><br><span class="line">  student.<span class="property">age</span> = +age;</span><br><span class="line">  student.<span class="property">gender</span> = gender;</span><br><span class="line">  <span class="title function_">next</span>();</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//创建处理存储文件的中间件</span></span><br><span class="line">router.<span class="title function_">use</span>(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  fs.<span class="title function_">writeFile</span>(</span><br><span class="line">    path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../data/students.json&quot;</span>),</span><br><span class="line">    <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="variable constant_">STUDENT</span>)</span><br><span class="line">  )</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">//重定向</span></span><br><span class="line">      res.<span class="title function_">redirect</span>(<span class="string">&quot;/students/list&quot;</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">catch</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(操作失败);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router;</span><br></pre></td></tr></table></figure>

<p><code>index.js</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs/promises&quot;</span>);</span><br><span class="line"><span class="comment">//引入router</span></span><br><span class="line"><span class="keyword">const</span> userRouter = <span class="built_in">require</span>(<span class="string">&quot;./router/user&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> goodsRouter = <span class="built_in">require</span>(<span class="string">&quot;./router/goods&quot;</span>);</span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">static</span>(path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;public&quot;</span>)));</span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">urlencoded</span>());</span><br><span class="line">app.<span class="title function_">set</span>(<span class="string">&quot;view engine&quot;</span>, <span class="string">&quot;ejs&quot;</span>);</span><br><span class="line">app.<span class="title function_">set</span>(<span class="string">&quot;views&quot;</span>, path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;views&quot;</span>));</span><br><span class="line"><span class="comment">//使用router</span></span><br><span class="line"><span class="comment">//指定路径,可以防止路由的路径命名冲突</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&quot;/user&quot;</span>, userRouter);</span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&quot;/goods&quot;</span>, goodsRouter);</span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&quot;/students&quot;</span>, <span class="built_in">require</span>(<span class="string">&quot;./router/student&quot;</span>));</span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;服务器已启动~&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h2><blockquote>
<p>Http 协议是一个无状态的协议,服务器无法区分发送请求的是同一个客户端</p>
<p><strong>Cookie</strong>:</p>
<ul>
<li>cookie 是 http 协议中用来解决无状态问题的技术</li>
<li>cookie 的本质是一个头<ol>
<li>服务器以响应头的形式将 cookie 发送给客户端,客户端收到以后会将其存储,并在下次向服务器发送请求时将其传回,这样服务器就可以根据 cookie 来识别出客户端了</li>
</ol>
</li>
<li><code>res.cookie()</code>来向客户端发送一个 cookie<ol>
<li>第一个参数传递 cookie 的名称</li>
<li>第二个参数传递 cookie 的值</li>
<li>第三个参数传递一个配置对象<em>options</em></li>
</ol>
</li>
<li><code>req.cookies.发送的cookie</code>:客户端携带 cookie</li>
<li>注意 cookie 发送给浏览器后就不能再进行删除,但是可以通过新的 cookie 替换旧的 cookie<ol>
<li>在配置对象中通过<code>maxAge: </code>(单位毫秒),来传递一个有效期为 0 毫秒的 cookie,对旧 cookie 进行替换,达到删除 cookie 的目的</li>
</ol>
</li>
</ul>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"><span class="keyword">const</span> cookieParser = <span class="built_in">require</span>(<span class="string">&quot;cookie-parser&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs/promises&quot;</span>);</span><br><span class="line"><span class="comment">//引入router</span></span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">static</span>(path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;public&quot;</span>)));</span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">urlencoded</span>());</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">cookieParser</span>());</span><br><span class="line">app.<span class="title function_">set</span>(<span class="string">&quot;view engine&quot;</span>, <span class="string">&quot;ejs&quot;</span>);</span><br><span class="line">app.<span class="title function_">set</span>(<span class="string">&quot;views&quot;</span>, path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;views&quot;</span>));</span><br><span class="line"><span class="comment">//使用router</span></span><br><span class="line"><span class="comment">//指定路径,可以防止路由的路径命名冲突</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&quot;/students&quot;</span>, <span class="built_in">require</span>(<span class="string">&quot;./router/student&quot;</span>));</span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/set&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">cookie</span>(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;zs&quot;</span>, &#123;</span><br><span class="line">    <span class="comment">// maxAge: 10000, //10S</span></span><br><span class="line">    <span class="attr">maxAge</span>: <span class="number">1000</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span> * <span class="number">30</span>, <span class="comment">//一个月</span></span><br><span class="line">  &#125;);</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">&quot;发送cookie&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/get&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">&quot;接收,携带cookie&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/delete-cookie&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//替换旧的cookie</span></span><br><span class="line">  res.<span class="title function_">cookie</span>(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;&quot;</span>, &#123;</span><br><span class="line">    <span class="attr">maxAge</span>: <span class="number">0</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">&quot;删除cookie&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;服务器已启动~&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="Session"><a href="#Session" class="headerlink" title="Session"></a>Session</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"><span class="comment">//引入session</span></span><br><span class="line"><span class="keyword">const</span> session = <span class="built_in">require</span>(<span class="string">&quot;express-session&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs/promises&quot;</span>);</span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">static</span>(path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;public&quot;</span>)));</span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">urlencoded</span>());</span><br><span class="line"><span class="comment">//使用session</span></span><br><span class="line">app.<span class="title function_">use</span>(</span><br><span class="line">  <span class="title function_">session</span>(&#123;</span><br><span class="line">    <span class="attr">secret</span>: <span class="string">&quot;hello&quot;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">);</span><br><span class="line">app.<span class="title function_">set</span>(<span class="string">&quot;view engine&quot;</span>, <span class="string">&quot;ejs&quot;</span>);</span><br><span class="line">app.<span class="title function_">set</span>(<span class="string">&quot;views&quot;</span>, path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;views&quot;</span>));</span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/set&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">session</span>);</span><br><span class="line">  req.<span class="property">session</span>.<span class="property">username</span> = <span class="string">&quot;zs&quot;</span>;</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">&quot;查看session&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/get&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> username = req.<span class="property">session</span>.<span class="property">username</span>;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(username);</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">&quot;获取session&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;服务器已启动~&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>cookie 的不足</strong>:</p>
<ul>
<li>由于 cookie 是有服务器创建,浏览器保存,每次浏览器访问服务器时都需要将 cookie 发回,导致了不能在 cookie 中存放较多的数据</li>
<li>cookie 是明文保存的(不能存放敏感信息)且直接存放在客户端,容易被窜改盗用</li>
</ul>
<p><strong>session</strong>:</p>
<ul>
<li>session 服务器中的一个对象,这个对象用来存储用户的数据</li>
<li>每一个 session 对象都有一个唯一的 id,id 会通过 cookie 的形式发送给客户端,客户端每次访问时只需要将存储有 id 的 cookie 发回即可获取他在服务器中存储的数据</li>
<li>使用<code>require.session</code>可以查看 session 或设置 session 的属性</li>
<li>session 默认的时效为一次会话</li>
</ul>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"><span class="comment">//引入cookie</span></span><br><span class="line"><span class="keyword">const</span> cookieParser = <span class="built_in">require</span>(<span class="string">&quot;cookie-parser&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs/promises&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> session = <span class="built_in">require</span>(<span class="string">&quot;express-session&quot;</span>);</span><br><span class="line"><span class="comment">//引入FileStore</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">FileStore</span> = <span class="built_in">require</span>(<span class="string">&quot;session-file-store&quot;</span>)(session);</span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">static</span>(path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;public&quot;</span>)));</span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">urlencoded</span>());</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">cookieParser</span>());</span><br><span class="line">app.<span class="title function_">use</span>(</span><br><span class="line">  <span class="title function_">session</span>(&#123;</span><br><span class="line">    <span class="attr">secret</span>: <span class="string">&quot;hello&quot;</span>,</span><br><span class="line">    <span class="attr">store</span>: <span class="keyword">new</span> <span class="title class_">FileStore</span>(&#123;</span><br><span class="line">      <span class="comment">//设置session存放路径</span></span><br><span class="line">      <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;./sessions&quot;</span>),</span><br><span class="line">      <span class="comment">//加密session</span></span><br><span class="line">      <span class="attr">secret</span>: <span class="string">&quot;张三&quot;</span>,</span><br><span class="line">      <span class="comment">//session的有效期(最大闲置时间)单位秒,默认1小时</span></span><br><span class="line">      <span class="attr">ttl</span>: <span class="number">3600</span>,</span><br><span class="line">      <span class="comment">//清除过期的session,单位秒,默认一小时</span></span><br><span class="line">      <span class="attr">reapInterval</span>: <span class="number">3600</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">  &#125;)</span><br><span class="line">);</span><br><span class="line">app.<span class="title function_">set</span>(<span class="string">&quot;view engine&quot;</span>, <span class="string">&quot;ejs&quot;</span>);</span><br><span class="line">app.<span class="title function_">set</span>(<span class="string">&quot;views&quot;</span>, path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;views&quot;</span>));</span><br><span class="line"><span class="comment">//使用router</span></span><br><span class="line"><span class="comment">//指定路径,可以防止路由的路径命名冲突</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&quot;/students&quot;</span>, <span class="built_in">require</span>(<span class="string">&quot;./router/student&quot;</span>));</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">render</span>(<span class="string">&quot;login&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&quot;/login&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; username, password &#125; = req.<span class="property">body</span>;</span><br><span class="line">  <span class="keyword">if</span> (username === <span class="string">&quot;admin&quot;</span> &amp;&amp; password === <span class="string">&quot;123000&quot;</span>) &#123;</span><br><span class="line">    req.<span class="property">session</span>.<span class="property">loginUser</span> = username; <span class="comment">//由于此时username存储在了内存中,并未保存在文件中,所以在第一次登录时拿不到username</span></span><br><span class="line">    <span class="comment">//使username立刻存储到文件中</span></span><br><span class="line">    req.<span class="property">session</span>.<span class="title function_">save</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      res.<span class="title function_">redirect</span>(<span class="string">&quot;/students/list&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&quot;用户名或密码错误&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/logout&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//立刻销毁session</span></span><br><span class="line">  req.<span class="property">session</span>.<span class="title function_">destroy</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    res.<span class="title function_">redirect</span>(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/set&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">cookie</span>(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;zs&quot;</span>, &#123;</span><br><span class="line">    <span class="comment">// maxAge: 10000, //10S</span></span><br><span class="line">    <span class="attr">maxAge</span>: <span class="number">1000</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span> * <span class="number">30</span>, <span class="comment">//一个月</span></span><br><span class="line">  &#125;);</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">&quot;发送cookie&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/get&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">&quot;接收,携带cookie&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/delete-cookie&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//替换旧的cookie</span></span><br><span class="line">  res.<span class="title function_">cookie</span>(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;&quot;</span>, &#123;</span><br><span class="line">    <span class="attr">maxAge</span>: <span class="number">0</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">&quot;删除cookie&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;服务器已启动~&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>session 持久化(写入文件&#x2F;存储数据库)</strong>:</p>
<ul>
<li>引入 FileStore 使 session 写入文件</li>
<li>FileStore 常用的配置对象:<ol>
<li><code>path</code>:设置 session 存放路径</li>
<li><code>secret</code>:加密 session</li>
<li><code>ttl</code>:session 的有效期(最大闲置时间)单位秒,默认 1 小时</li>
<li><code>reapInterval</code>:清除过期的 session,单位秒,默认一小时</li>
</ol>
</li>
<li>session 的方法:<ol>
<li><code>destroy</code>:立刻销毁 session</li>
<li><code>save</code>:立刻存储到文件</li>
</ol>
</li>
</ul>
</blockquote>
<h2 id="csrf-攻击"><a href="#csrf-攻击" class="headerlink" title="csrf 攻击"></a>csrf 攻击</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>csrf攻击<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>这个网站里有你想要的所有东西<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;http://localhost:3000/students/delete?id=7&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;正在加载中...&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- &lt;iframe style=&quot;display: none;&quot; name=&quot;hello&quot;&gt;&lt;/iframe&gt;</span></span><br><span class="line"><span class="comment">  &lt;form action=&quot;http://localhost:3000/students/add&quot; method=&quot;post&quot; target=&quot;hello&quot;&gt;</span></span><br><span class="line"><span class="comment">    &lt;input type=&quot;text&quot; name=&quot;name&quot; value=&quot;张三&quot;&gt;</span></span><br><span class="line"><span class="comment">    &lt;input type=&quot;text&quot; name=&quot;age&quot; value=&quot;18&quot;&gt;</span></span><br><span class="line"><span class="comment">    &lt;input type=&quot;text&quot; name=&quot;gender&quot; value=&quot;女&quot;&gt;</span></span><br><span class="line"><span class="comment">  &lt;/form&gt;</span></span><br><span class="line"><span class="comment">  &lt;script&gt;</span></span><br><span class="line"><span class="comment">    document.forms[0].submit();</span></span><br><span class="line"><span class="comment">  &lt;/script&gt; --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>csrf 攻击(跨站请求伪造)</strong>:</p>
<p>简单的身份验证只能保证请求发自某个用户的浏览器，却不能保证请求本身是用户自愿发出的</p>
</blockquote>
<h2 id="处理-csrf-攻击"><a href="#处理-csrf-攻击" class="headerlink" title="处理 csrf 攻击"></a>处理 csrf 攻击</h2><p><strong>referer 头检查请求的来源</strong>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//统一权限检查</span></span><br><span class="line">router.<span class="title function_">use</span>(<span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//检查请求头</span></span><br><span class="line">  <span class="comment">//获取请求头</span></span><br><span class="line">  <span class="keyword">const</span> referer = req.<span class="title function_">get</span>(<span class="string">&quot;referer&quot;</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(referer);</span><br><span class="line">  <span class="keyword">if</span> (!referer || !referer.<span class="title function_">startsWith</span>(<span class="string">&quot;http://localhost:3000/&quot;</span>)) &#123;</span><br><span class="line">    res.<span class="title function_">status</span>(<span class="number">403</span>).<span class="title function_">send</span>(<span class="string">&quot;你没有这个权限&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (req.<span class="property">session</span>.<span class="property">loginUser</span>) &#123;</span><br><span class="line">    <span class="title function_">next</span>();</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    res.<span class="title function_">redirect</span>(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>post 请求结合 token</strong>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//学生列表路由</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/list&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//生成一个token</span></span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">CsrfToken</span> = <span class="title function_">uuid</span>();</span><br><span class="line">  <span class="comment">//将token添加到session中</span></span><br><span class="line">  req.<span class="property">session</span>.<span class="property">csrfToken</span> = <span class="title class_">CsrfToken</span>;</span><br><span class="line">  req.<span class="property">session</span>.<span class="title function_">save</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    res.<span class="title function_">render</span>(<span class="string">&quot;students&quot;</span>, &#123;</span><br><span class="line">      <span class="attr">stus</span>: <span class="variable constant_">STUDENT</span>,</span><br><span class="line">      <span class="attr">username</span>: req.<span class="property">session</span>.<span class="property">loginUser</span>,</span><br><span class="line">      <span class="title class_">CsrfToken</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//添加学生路由</span></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&quot;/add&quot;</span>, <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//拿到客户端发送的token</span></span><br><span class="line">  <span class="keyword">const</span> csrfToken = req.<span class="property">body</span>.<span class="property">_csrf</span>;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(csrfToken);</span><br><span class="line">  <span class="comment">//session的token</span></span><br><span class="line">  <span class="keyword">const</span> sessionToken = req.<span class="property">session</span>.<span class="property">csrfToken</span>;</span><br><span class="line">  req.<span class="property">session</span>.<span class="property">csrfToken</span> = <span class="literal">null</span>;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(sessionToken);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(sessionToken === csrfToken);</span><br><span class="line">  <span class="comment">//把客户端的token与session的token进行比对</span></span><br><span class="line">  <span class="keyword">if</span> (sessionToken.<span class="title function_">trim</span>() === csrfToken.<span class="title function_">trim</span>()) &#123;</span><br><span class="line">    <span class="comment">//生成一个id</span></span><br><span class="line">    <span class="keyword">const</span> id = <span class="variable constant_">STUDENT</span>.<span class="title function_">at</span>(-<span class="number">1</span>) ? <span class="variable constant_">STUDENT</span>.<span class="title function_">at</span>(-<span class="number">1</span>).<span class="property">id</span> + <span class="number">1</span> : <span class="number">1</span>;</span><br><span class="line">    <span class="comment">//1.获取用户填写的信息</span></span><br><span class="line">    <span class="keyword">const</span> &#123; name, age, gender &#125; = req.<span class="property">body</span>;</span><br><span class="line">    <span class="keyword">const</span> newUser = &#123;</span><br><span class="line">      id,</span><br><span class="line">      <span class="attr">name</span>: name,</span><br><span class="line">      <span class="attr">age</span>: +age,</span><br><span class="line">      <span class="attr">gender</span>: gender,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">//2.验证用信息(略)</span></span><br><span class="line">    <span class="comment">//3.将用户信息添加到数据中</span></span><br><span class="line">    <span class="variable constant_">STUDENT</span>.<span class="title function_">push</span>(newUser);</span><br><span class="line">    <span class="comment">//调用next让后续路由继续处理,进入存储文件中间件</span></span><br><span class="line">    req.<span class="property">session</span>.<span class="title function_">save</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">next</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    res.<span class="title function_">status</span>(<span class="number">403</span>).<span class="title function_">send</span>(<span class="string">&quot;token出错&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>处理 csrf 攻击的方式</strong>:</p>
<ul>
<li>检查请求头,使用<code>referer</code>头来检查请求的来源</li>
<li>使用验证码</li>
<li>尽量使用 post 请求(结合 token)</li>
</ul>
<p><strong>token</strong>:</p>
<ul>
<li>可以在创建表单时随机生成一个令牌,存储到 session 中,并通过模板发送给用户,用户提交表单时,必须将 token 发回,才可以进行后续操作</li>
<li>可以用 uuid 来生成唯一的 token</li>
</ul>
</blockquote>
<p><strong>遇到的问题</strong>:</p>
<p><img src="https://raw.githubusercontent.com/ehco666/to-picgo/main/img/uuid%E5%AD%98%E5%9C%A8%E7%9A%84%E9%97%AE%E9%A2%98.png" alt="image-20221117223448659"></p>
<p><code>https://raw.githubusercontent.com/ehco666/to-picgo/main/img/uuid%E5%AD%98%E5%9C%A8%E7%9A%84%E9%97%AE%E9%A2%98.png</code></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://hun.ghao.live">ehco</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://hun.ghao.live/posts/102acd90.html">https://hun.ghao.live/posts/102acd90.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://hun.ghao.live" target="_blank">Hun</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%89%8D%E7%AB%AF-Node/">前端/Node</a></div><div class="post_share"><div class="social-share" data-image="https://img0.baidu.com/it/u=302718224,1591236974&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=JPEG?w=600&amp;h=450" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/5f7d6ba1.html"><img class="prev-cover" src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fc-ssl.duitang.com%2Fuploads%2Fitem%2F201510%2F27%2F20151027123805_jxVmL.thumb.400_0.jpeg&amp;refer=http%3A%2F%2Fc-ssl.duitang.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=auto?sec=1668955992&amp;t=3a44f605814c1174886c67f897e5590d" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">09两道面试题</div></div></a></div><div class="next-post pull-right"><a href="/posts/cbe485bd.html"><img class="next-cover" src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fc-ssl.duitang.com%2Fuploads%2Fitem%2F201510%2F27%2F20151027123805_jxVmL.thumb.400_0.jpeg&amp;refer=http%3A%2F%2Fc-ssl.duitang.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=auto?sec=1668955992&amp;t=3a44f605814c1174886c67f897e5590d" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">01Node.js简介</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/posts/cbe485bd.html" title="01Node.js简介"><img class="cover" src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fc-ssl.duitang.com%2Fuploads%2Fitem%2F201510%2F27%2F20151027123805_jxVmL.thumb.400_0.jpeg&refer=http%3A%2F%2Fc-ssl.duitang.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=auto?sec=1668955992&t=3a44f605814c1174886c67f897e5590d" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-10-21</div><div class="title">01Node.js简介</div></div></a></div><div><a href="/posts/cace4ac6.html" title="02同步与异步"><img class="cover" src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fhbimg.b0.upaiyun.com%2Faf89e3bb5c141732d945544948fff24df6f36945bf22-DfOqnD_fw658&refer=http%3A%2F%2Fhbimg.b0.upaiyun.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=auto?sec=1668956014&t=cce783c22dd4066420844884c5ecdb78" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-10-21</div><div class="title">02同步与异步</div></div></a></div><div><a href="/posts/c60d450e.html" title="02Promise"><img class="cover" src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fhbimg.b0.upaiyun.com%2Faf89e3bb5c141732d945544948fff24df6f36945bf22-DfOqnD_fw658&refer=http%3A%2F%2Fhbimg.b0.upaiyun.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=auto?sec=1668956014&t=cce783c22dd4066420844884c5ecdb78" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-10-21</div><div class="title">02Promise</div></div></a></div><div><a href="/posts/5f7d6bb9.html" title="04宏任务与微任务"><img class="cover" src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fc-ssl.duitang.com%2Fuploads%2Fitem%2F201510%2F27%2F20151027123805_jxVmL.thumb.400_0.jpeg&refer=http%3A%2F%2Fc-ssl.duitang.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=auto?sec=1668955992&t=3a44f605814c1174886c67f897e5590d" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-10-21</div><div class="title">04宏任务与微任务</div></div></a></div><div><a href="/posts/ae459a89.html" title="05手写Promise"><img class="cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-10-21</div><div class="title">05手写Promise</div></div></a></div><div><a href="/posts/4e11ea07.html" title="06async"><img class="cover" src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fc-ssl.duitang.com%2Fuploads%2Fitem%2F201510%2F27%2F20151027123805_jxVmL.thumb.400_0.jpeg&refer=http%3A%2F%2Fc-ssl.duitang.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=auto?sec=1668955992&t=3a44f605814c1174886c67f897e5590d" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-10-21</div><div class="title">06async</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="lv-container" data-id="city" data-uid="MTAyMC81NzA1NS8zMzUxOQ=="></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/./images/touxiang.jpeg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">ehco</div><div class="author-info__description">学习笔记,学如逆水行舟</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">45</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">6</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><a id="card-info-btn" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/rhco666"><i class="fab fa-github"></i><span>关注我</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/ehco666" rel="external nofollow noreferrer" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:xxxxxx@gmail.com" rel="external nofollow noreferrer" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">欢迎来到hun博客</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Express"><span class="toc-number">1.</span> <span class="toc-text">Express</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-number">1.1.</span> <span class="toc-text">路由和中间件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90"><span class="toc-number">1.2.</span> <span class="toc-text">静态资源</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#param-%E5%92%8C-post"><span class="toc-number">1.3.</span> <span class="toc-text">param 和 post</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E"><span class="toc-number">1.4.</span> <span class="toc-text">模板引擎</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Router"><span class="toc-number">1.5.</span> <span class="toc-text">Router</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Cookie"><span class="toc-number">1.6.</span> <span class="toc-text">Cookie</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Session"><span class="toc-number">1.7.</span> <span class="toc-text">Session</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#csrf-%E6%94%BB%E5%87%BB"><span class="toc-number">1.8.</span> <span class="toc-text">csrf 攻击</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%84%E7%90%86-csrf-%E6%94%BB%E5%87%BB"><span class="toc-number">1.9.</span> <span class="toc-text">处理 csrf 攻击</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/677955c1.html" title="01React简介"><img src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fc-ssl.duitang.com%2Fuploads%2Fitem%2F201510%2F27%2F20151027123805_jxVmL.thumb.400_0.jpeg&amp;refer=http%3A%2F%2Fc-ssl.duitang.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=auto?sec=1668955992&amp;t=3a44f605814c1174886c67f897e5590d" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="01React简介"/></a><div class="content"><a class="title" href="/posts/677955c1.html" title="01React简介">01React简介</a><time datetime="2022-12-19T12:57:12.647Z" title="发表于 2022-12-19 12:57:12">2022-12-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/92f4c395.html" title="02jsx与虚拟DOM"><img src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fhbimg.b0.upaiyun.com%2Faf89e3bb5c141732d945544948fff24df6f36945bf22-DfOqnD_fw658&amp;refer=http%3A%2F%2Fhbimg.b0.upaiyun.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=auto?sec=1668956014&amp;t=cce783c22dd4066420844884c5ecdb78" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="02jsx与虚拟DOM"/></a><div class="content"><a class="title" href="/posts/92f4c395.html" title="02jsx与虚拟DOM">02jsx与虚拟DOM</a><time datetime="2022-12-19T12:57:12.647Z" title="发表于 2022-12-19 12:57:12">2022-12-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/9a7f8a09.html" title="03函数式组件"><img src="https://img0.baidu.com/it/u=302718224,1591236974&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=JPEG?w=600&amp;h=450" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="03函数式组件"/></a><div class="content"><a class="title" href="/posts/9a7f8a09.html" title="03函数式组件">03函数式组件</a><time datetime="2022-12-19T12:57:12.647Z" title="发表于 2022-12-19 12:57:12">2022-12-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/c139d316.html" title="04类组件"><img src="https://img0.baidu.com/it/u=302718224,1591236974&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=JPEG?w=600&amp;h=450" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="04类组件"/></a><div class="content"><a class="title" href="/posts/c139d316.html" title="04类组件">04类组件</a><time datetime="2022-12-19T12:57:12.647Z" title="发表于 2022-12-19 12:57:12">2022-12-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/a2d68f38.html" title="05学习记录器练习"><img src="https://img0.baidu.com/it/u=302718224,1591236974&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=JPEG?w=600&amp;h=450" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="05学习记录器练习"/></a><div class="content"><a class="title" href="/posts/a2d68f38.html" title="05学习记录器练习">05学习记录器练习</a><time datetime="2022-12-19T12:57:12.647Z" title="发表于 2022-12-19 12:57:12">2022-12-19</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By ehco</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function loadLivere () {
  if (typeof LivereTower === 'object') {
    window.LivereTower.init()
  }
  else {
    (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
    })(document, 'script');
  }
}

if ('Livere' === 'Livere' || !false) {
  if (false) btf.loadComment(document.getElementById('lv-container'), loadLivere)
  else loadLivere()
}
else {
  function loadOtherComment () {
    loadLivere()
  }
}</script></div><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["meta[property=\"og:image\"]","meta[property=\"og:title\"]","meta[property=\"og:url\"]","head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>